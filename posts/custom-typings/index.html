<!DOCTYPE html><html lang="en"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>How to add custom types into the TypeScript project</title><meta name="description" content="Tutorial how to add custom types (typings) for third-party code into the TypeScript project or how to solve &quot;could not find a declaration file&quot;"><meta name="keywords" content="typings, types, typescript, dts, custom types, could not find a declaration file"><link rel="canonical" href="https://drag13.io/posts/custom-typings/index.html"><meta name="application-name" content="Drag13 programmer's blog"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="author" content="Drag13"><meta name="robots" content="index follow"><meta name="application-name" content="Drag13 Dev Blog"><link rel="stylesheet" href="/common.91402137.css"><link rel="stylesheet" href="/post.abd2e44d.css"><link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144x144.183f717d.png"><link rel="apple-touch-icon-precomposed" sizes="152x152" href="/apple-touch-icon-152x152.950bb193.png"><link rel="icon" type="image/png" href="/favicon-32x32.cf64321e.png" sizes="32x32"><link rel="icon" type="image/png" href="/favicon-16x16.65ddeb5a.png" sizes="16x16"><link rel="manifest" href="/manifest.webmanifest"><body><nav class="nav"><a href="/">Home</a><a href="https://github.com/Drag13"><svg height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></nav><main class="main"><div class="content markdown-body"><article class="post"><h1>How to add custom types to the TypeScript project</h1>
<p>Working with TypeScript is very comfortable. It provides Intellisense, type-checking, and makes the developer's life much easier. But, sometimes, when I am using external libraries, I got a problem. They don't provide types or shipped types that are outdated. In this case, there is no other option but to define custom typings my own. Luckily, it's not that hard as you may expect.</p>
<h2>Before we start</h2>
<p>Before you start adding custom types you need to ensure that there are no original types. Nowadays, packages that don't ship typings with themselves could be found under <code>@types/package-name</code>. So, first of all - check <code>@types</code>. And only if there is nothing suitable, create your own.</p>
<h2>Create custom typings</h2>
<p>So, we need to create custom typings. Imagine that we are using library "my-test-lib" and need to provide types for it.</p>
<pre><code class="language-typescript"><span class="token keyword">import</span> mainAnswer <span class="token keyword">from</span> <span class="token string">'my-test-lib'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> answer <span class="token operator">=</span> <span class="token function">mainAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>answer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Here is the example of the 3rd party code we will annotate:</p>
<pre><code class="language-js"><span class="token keyword">function</span> <span class="token function">main_answer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> main_answer<span class="token punctuation">;</span>
</code></pre>
<ul>
<li>Create a root folder for your types. You can give any name for it but let it be <code>types</code> for now.</li>
<li>Create <code>my-test-lib.d.ts</code> file inside the types folder (name also can be any, it doesn't matter)</li>
<li>Put this example inside the file</li>
</ul>
<pre><code class="language-typescript"><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">"my-test-lib"</span> <span class="token punctuation">{</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">main_answer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>That's it! Now it should work! The main trick is to <strong>name module with the same name as library you want to annotate</strong>. TypeScript is smart enough to automatically find your custom types, match module name with library name, and use types from the declaration.</p>
<p>But sometimes this will not work.</p>
<h2>Could not find a declaration file for module 'my-test-lib'</h2>
<p>You did everything right but tsc still failing with:</p>
<p><img src="/error.1fb22a6f.png" alt="Could not find a declaration file for module error"></p>
<blockquote>
<p>"Could not find a declaration file for module".</p>
</blockquote>
<p>What is wrong? One of the reason might be that you are using include and/or files option in tsconfig.json, like here:</p>
<pre><code class="language-json">  <span class="token property">"files"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"./src/index.ts"</span><span class="token punctuation">]</span>
  <span class="token property">"include"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"./src"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre>
<p>In this case, TypeScript will not search for your types anywhere except node_modules and your src folder. And if you put types to the <code>.root/types</code> it will not pick up them. That's why you see this "Could not find a declaration" error. To fix this you need to include a folder with types, using include option, like this:</p>
<pre><code class="language-json"><span class="token property">"include"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"./src"</span><span class="token punctuation">,</span> <span class="token string">"./types"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token property">"files"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"./src/index.ts"</span><span class="token punctuation">]</span>
</code></pre>
<p>Another reason, why you see this error might be because you are using the wrong tsconfig.json file. As an example, Angular creates several tsconfig.json files used for different purposes (testing, production build, etc). So, don't forget to check the correctness of the tsconfig files.</p>
<h2>Few words about typeRoots</h2>
<p>What about "typeRoots"? Isn't this option should fix all issues? The quick answer is - no. Typeroots option was created <a href="https://github.com/microsoft/TypeScript/issues/22217#issuecomment-370019383">only for the backward compatiblity</a>, so in certain circumstances, it might help but should be avoided if possible. However, VsCode uses this option to pick-up types for IntelliSense, so be aware :)</p>
<h2>Troubleshooting</h2>
<p>TypeScript is much more complicated than we see. Sometimes, despite all efforts, types will no be applied. In this case, I would recommend using <code>--traceResolution</code> flag to check how tsc tried to resolve modules. This might save a couple of hours for you.</p>
<p>Hope this helps, see you soon!</p>
<p class="tag">[26.06.2020] #typescript #dts, #custom-types</p></article></div></main><footer class="footer"><a href="https://github.com/Drag13/drag13.github.io/blob/development/LICENSE" target="_blank">2020 MIT by Drag13</a></footer></body></html>