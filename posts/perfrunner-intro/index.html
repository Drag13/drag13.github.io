<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'none'"><title>Perfrunner - an automated testing tool to check your web site performance improvements against various conditions</title><meta property="og:title" content="Perfrunner - an automated testing tool to check your web site performance improvements against various conditions"><meta name="description" content="How to profile and verify performance web site performance improvements various different network and CPU conditions using Perfrunner"><meta property="og:description" content="How to profile and verify performance web site performance improvements various different network and CPU conditions using Perfrunner"><meta name="keywords" content="perfrunner-cli perfrunner performance fcp first-contentful-paint performance-metrics puppeteer front-end webtesting performance-testing"><link rel="canonical" href="https://drag13.io/posts/perfrunner-intro/index.html"><meta property="og:url" content="https://drag13.io/posts/perfrunner-intro/index.html"><meta property="og:type" content="website"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="https://twitter.com/drag137"><meta name="twitter:url" content="https://drag13.io/posts/perfrunner-intro/index.html"><meta name="twitter:title" content="Perfrunner - an automated testing tool to check your web site performance improvements against various conditions"><meta name="twitter:description" content="How to profile and verify performance web site performance improvements various different network and CPU conditions using Perfrunner"><meta name="og:site_name" content="Drag13 dev blog"><meta property="og:image" content="https://drag13.io/perfrunner-intro.888211fb.jpg"><meta name="twitter:image" content="https://drag13.io/perfrunner-intro.888211fb.jpg"><meta name="application-name" content="Drag13 programmer's blog"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="author" content="Drag13"><meta name="robots" content="index follow"><meta name="application-name" content="Drag13 Dev Blog"><link rel="stylesheet" href="https://drag13.io/common.67e40877.css"><link rel="stylesheet" href="https://drag13.io/post.45f546f7.css"><link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://drag13.io/apple-touch-icon-144x144.f6d9dce4.png"><link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://drag13.io/apple-touch-icon-152x152.5c0b4e01.png"><link rel="icon" type="image/png" href="https://drag13.io/favicon-32x32.2ff4c37a.png" sizes="32x32"><link rel="icon" type="image/png" href="https://drag13.io/favicon-16x16.60caff07.png" sizes="16x16"><link rel="manifest" href="https://drag13.io/manifest.webmanifest"><body><nav class="nav"><a class="link" href="/">Home</a><div><a class="icon" href="https://github.com/Drag13" target="_blank"><svg height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a><a class="icon" href="https://twitter.com/drag137" target="_blank"><svg height="32" width="32" viewBox="0 0 24 24" aria-hidden="true" fill="rgba(29,161,242,1.00)"><path d="M23.643 4.937c-.835.37-1.732.62-2.675.733a4.67 4.67 0 002.048-2.578 9.3 9.3 0 01-2.958 1.13 4.66 4.66 0 00-7.938 4.25 13.229 13.229 0 01-9.602-4.868c-.4.69-.63 1.49-.63 2.342A4.66 4.66 0 003.96 9.824a4.647 4.647 0 01-2.11-.583v.06a4.66 4.66 0 003.737 4.568 4.692 4.692 0 01-2.104.08 4.661 4.661 0 004.352 3.234 9.348 9.348 0 01-5.786 1.995 9.5 9.5 0 01-1.112-.065 13.175 13.175 0 007.14 2.093c8.57 0 13.255-7.098 13.255-13.254 0-.2-.005-.402-.014-.602a9.47 9.47 0 002.323-2.41z"/></svg></a></div></nav><main class="main"><div class="content markdown-body"><article class="post"><h1>Perfrunner - an automated testing tool to check your web site performance improvements against various conditions.</h1>
<p><img src="https://drag13.io/perfrunner-intro.888211fb.jpg" alt="perfrunner intro image"></p>
<h2>Quick intro</h2>
<p>A few months ago I worked on performance improvements for one React-based web application. I tried different tricks to improve initial application loading and I was really annoyed with the way of testing my changes. I had to launch the application several times to get average results. I had to repeat all launches against at least two types of networks (4g and my current). And I had repeat abovementioned tests once again for cache and cache-less scenarios. For the one single change, I had to run at least 12 tests. Needless to say, this was not fun.</p>
<p>I decided that I don't want to do this anymore and this is how the <a href="https://github.com/Drag13/perfrunner">Perfrunner</a> appeared.</p>
<p>Perfrunner is a simple CLI tool that launches your web site or web application, collects performance metrics, and reports them back to you. The cool part is that Perfrunner does not only a single run but a series of runs against different networks, cache and CPU conditions!</p>
<p>In other words, Perfrunner loads your application several times (3 by default) against each condition, calculates average results, and displays you the difference between all previous runs. You don't have to run them manually anymore or calculate difference anymore, it is all automated!</p>
<h2>Demo</h2>
<p>Let's start from a simple demo.</p>
<p>First things first, you need to install Perfrunner and add launch script to the package.json file:</p>
<pre><code class="language-cmd"><span class="token function">npm</span> i perfrunner -D
</code></pre>
<pre><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"perfrunner"</span><span class="token operator">:</span> <span class="token string">"perfrunner"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>and run Perfrunner to get inital data.</p>
<pre><code class="language-cmd"><span class="token function">npm</span> run perfrunner https://drag13.io
</code></pre>
<p>Now, change something that might affect performance (I added jQuery to the top of the page) and run Perfrunner one more time. Open folder named <code>generated/{your_site_name}</code> and then open a <code>default-report.html</code> file.</p>
<p>It will look like this (clickable):</p>
<p><a href="https://drag13.io/original.94c91eda.png" target="_blank"><img alt="Perfrunner report for original network, 25ms diff for largest-contentful-paint" src="https://drag13.io/original.94c91eda.png"></a></p>
<p>In this report you will see at least four different charts:</p>
<ul>
<li>Application Events with <code>First-Paint</code>, <code>First-Contentful-Paint</code>, <code>Largest-Contentfult-Paint</code>, <code>DomContentLoaded</code> and <code>DomInteractive</code> events</li>
<li>Common performance metrics like <code>Layout Duration</code>, <code>Script Duration</code> and <code>Recalculate Style Duration</code></li>
<li>Size of the resources loaded before the First-Contentful-Paint event</li>
<li>All resources size</li>
</ul>
<p>If you are using performance marks, you will also get marks chart as well.</p>
<p>But what is perhaps the most important point, you can switch to the second tab and see how your changes affect the performance for another network/CPU/cache conditions:</p>
<p><a href="https://drag13.io/fast3g.31f83906.png" target="_blank"><img alt="Perfrunner report for original network, 25ms diff for largest-contentful-paint" src="https://drag13.io/fast3g.31f83906.png"></a></p>
<p>As you can see, for the fast-3G network, the First-Contentful-Paint event appeared 75 ms later than for the regular network.</p>
<p>You can also instruct Perfrunner to use additional network conditions, like <code>slow-3g</code> or <code>regular-4g</code>:</p>
<pre><code class="language-cmd"><span class="token function">npm</span> run perfrunner http://drag13.io -- --network slow-3g fast-3g hspa regular-4g online
</code></pre>
<p>or you can do testing against cached or not cached resources:</p>
<pre><code class="language-cmd"><span class="token function">npm</span> run perfrunner http://drag13.io -- --cache <span class="token boolean">true</span> <span class="token boolean">false</span>
</code></pre>
<p>And of course you can combine different options together to get as much information as you need:</p>
<pre><code class="language-cmd"><span class="token function">npm</span> run perfrunner http://drag13.io -- --network slow-3g fast-3g hspa regular-4g online --cache <span class="token boolean">true</span> <span class="token boolean">false</span>
</code></pre>
<p>Apart from network conditions, Perfrunner also supports CPU throttling with -T flag:</p>
<pre><code class="language-cmd"><span class="token function">npm</span> run perfrunner http://drag13.io -- -T <span class="token number">8</span>
</code></pre>
<p>This will set 8x throttling for your CPU. It is useful when you want to test your changes against slow devices.</p>
<p>For more available options, please check <a href="https://github.com/Drag13/perfrunner/tree/development/packages/perfrunner-cli#all-options">readme</a></p>
<h2>Advanced tricks</h2>
<p>Perfrunner is more flexible than it appears at first sight. First of all, if you don't want default-html reporter, you can switch it to CSV or JSON format, using <code>--reporter</code> flag. You also can write your own reporter and use it with option:</p>
<pre><code>npx perfrunner http://drag13.io --reporter my-custom-reporter.js
</code></pre>
<p>where reporter should look like:</p>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">outputFolder<span class="token punctuation">,</span> data<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>outputFolder<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Another useful trick is that Perfrunner also collects all Chrome traces from every test run. If you will need more detailed information, you can open <code>generated/{your_site_name/traces}</code> and get all the additional information you need.</p>
<h2>Troubleshooting.</h2>
<p>Perfrunner is based on <a href="https://github.com/puppeteer/puppeteer">puppeteer</a>, so it has all weaknesses and advantages of it. If you struggle with launching Perfrurunner, please visit <a href="https://developers.google.com/web/tools/puppeteer/troubleshooting">troubleshooting</a> page. From my side, Perfrunner supports <code>--chrome-args</code> and <code>--ignore-default-args</code> flags. It also supports <code>--executablePath</code>, so you can launch Perfrunner on your own Chrome instance if nothing else helps.</p>
<h2>Final words</h2>
<p>Summarizing, Perfrunner is a great tool to quickly check your performance improvements. It supports various network conditions, CPU throttling, and much more. If you have any questions, suggestions, or found an issue, feel free to visit <a href="https://github.com/Drag13/perfrunner/issues">github</a> or contact me on <a href="https://twitter.com/drag137">twitter</a>.</p>
<p>Wish you the fastest app!</p>
<p>Thanks @veri-ivanova for the main image</p>
<p class="tag">[02.08.2020] #perfrunner-cli #perfrunner #performance #fcp #first-contentful-paint #performance-metrics #puppeteer #front-end #webtesting #performance-testing</p></article></div></main><footer class="footer"><a href="https://github.com/Drag13/drag13.github.io/blob/development/LICENSE" target="_blank">2020 MIT by Drag13</a></footer></body></html>