<!DOCTYPE html><html lang="en"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Free Continuous Integration for your GitHub project</title><meta name="application-name" content="Drag13 programmer's blog"><meta name="description" content="Blog about web-programming, cloud computing, web-site performance and profiling"><meta name="keywords" content="programming, web-programming, javascript, performance, web-performance, performance-tuning, .net, c#, f#, html, css, drag13"><meta name="author" content="Drag13"><meta name="robots" content="index follow"><meta name="application-name" content="Drag13 Dev Blog"><link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144x144.183f717d.png"><link rel="apple-touch-icon-precomposed" sizes="152x152" href="/apple-touch-icon-152x152.950bb193.png"><link rel="icon" type="image/png" href="/favicon-32x32.cf64321e.png" sizes="32x32"><link rel="icon" type="image/png" href="/favicon-16x16.65ddeb5a.png" sizes="16x16"><link rel="manifest" href="/manifest.js"><link rel="stylesheet" href="/markdown.6d9eff44.css"><link rel="stylesheet" href="/site.21abf370.css"><body><nav class="nav"><a href="/">Home</a><a href="https://github.com/Drag13">GitHub</a></nav><main class="main"><div class="content markdown-body"><article><h1>Free Continuous Integration for your GitHub project with three easy steps - build, test, deploy</h1>
<p>Hi guys! Today we will learn how to setup Continuous Integration process for the C# project hosted on GitHub. This is very easy, can really improve your code quality and you always be sure that no one destroys your code with latest commit. Are you interested? Let's give it a try!</p>
<h2>You will need</h2>
<ul>
<li><a href="https://github.com">GitHub account</a></li>
<li><a href="https://www.microsoft.com/net/">.NET Core SDK &gt; 2.1.</a></li>
<li><a href="https://www.visualstudio.com/">Visual Studio 2017</a></li>
<li><a href="https://portal.azure.com/">Azure account</a> - optional</li>
</ul>
<p>Let's start.</p>
<h2>Start a new project</h2>
<p>Create a new repository on GitHub and clone it locally. Don't forget to select .gitignore file template for VisualStudio to keep your repository clean and nice. Than generate new .NET Ð¡ore web application with</p>
<pre><code class="language-cmd">dotnet new sln --name CIDemo
dotnet new web --name web
dotnet sln CIDemo.sln add web/web.csproj
</code></pre>
<p>Commit your changes directly to master and push them to the remote.</p>
<h2>CI Build</h2>
<p>Now we will setup first step of the CI process - build check.</p>
<p>Go to the <a href="https://travis-ci.org/">Travis</a> and log in with GitHub account. Give Travis access to your repository.</p>
<p>Go back to the repository, create new branch CIBuild and add the .travis.yml file to the root of the folder</p>
<pre><code class="language-text">language: csharp

dotnet: 2.1.4
sudo: false

env:
    global:
        - DOTNET_CLI_TELEMETRY_OPTOUT: 1

script:
    - dotnet build CIDemo.sln -c Release
</code></pre>
<p>.travis.yml file will keep your Travis settings and configure your CI process. Right now it contains:</p>
<ul>
<li>language - your programming language.</li>
<li>dotnet - version of the required dotnet SDK</li>
<li>env - environment variables passed to the build process. I've added DOTNET_CLI_TELEMETRY_OPTOUT to <a href="https://docs.microsoft.com/en-us/dotnet/core/tools/telemetry">switch off</a> telemetry.</li>
<li>script - commands for Travis.</li>
</ul>
<p>Commit and push your changes, then make a pull request. Now you should see something like this:</p>
<p><img src="https://raw.githubusercontent.com/Drag13/articles/master/DotnetCI/imgs/TravisBuildSuccess.PNG" alt="Travis ok image"></p>
<p>This means that all is going ok. If you create a pull request that will not be buildable, Travis will report this.</p>
<p><img src="https://raw.githubusercontent.com/Drag13/articles/master/DotnetCI/imgs/TravisBuildFailed.PNG" alt="Travis failed image"></p>
<p>Don't forget to take build badge from the personal cabinet.
<a href="https://travis-ci.org/Drag13/CIDemo"><img src="https://travis-ci.org/Drag13/CIDemo.svg?branch=master" alt="Build Status"></a></p>
<h2>CI Tests</h2>
<p>Now let's configure tests for our CI process. The main idea of this step is to check that new code doesn't break your existing code and keep code coverage on the acceptable level.</p>
<p>Inside the solution, create the new project Test. Add <a href="https://github.com/tonerdo/coverlet">coverlet.msbuild</a> NuGet package to the Test project. It will generate code coverage report file.</p>
<pre><code class="language-cmd">dotnet new xunit --name test
dotnet add test/test.csproj package coverlet.msbuild -v 1.2.0
dotnet sln CIDemo.sln add test/test.csproj
</code></pre>
<p>Inside web project create the new class</p>
<pre><code class="language-c#">using System;

namespace web
{
    public class IdProvider
    {
        public Guid NewId()
        {
            return Guid.NewGuid();
        }
    }
}
</code></pre>
<p>Inside the Test project create the new class</p>
<pre><code class="language-c#">using web;
using Xunit;

namespace test
{
    public class IdProviderTest
    {
        [Fact]
        public void NewIdShouldReturnUniqueValues()
        {
            var idProvider = new IdProvider();
            var id1 = idProvider.NewId();
            var id2 = idProvider.NewId();

            Assert.NotEqual(id1, id2);
        }
    }
}
</code></pre>
<p>Update travis.yml file and add this line to the script section:</p>
<pre><code class="language-cmd"> - dotnet test -c Release --no-build test/test.csproj /p:CollectCoverage=true /p:CoverletOutputFormat=opencover
</code></pre>
<p>If you want you can specify threshold level:</p>
<pre><code class="language-cmd">dotnet test /p:CollectCoverage=true /p:Threshold=TRESHOLD_LVL
</code></pre>
<p>If your code coverage becomes lower than TRESHOLD_LVL you will receive an error. This is useful when you like to have not less than the certain level of code coverage</p>
<p>Go to the <a href="https://codecov.io">Codecov</a>, log in with your GitHub account and give access to your repository.</p>
<p>Add this to the end of the .travis.yml file</p>
<pre><code class="language-text">    after_script:
        - bash &lt;(curl -s https://codecov.io/bash)
</code></pre>
<p>Commit and push. Now you should see something like this</p>
<p><img src="https://raw.githubusercontent.com/Drag13/articles/master/DotnetCI/imgs/CoverageReportSmall.png" alt="Codecov report image"></p>
<p>Don't forget to take second badge.
<a href="https://codecov.io/gh/Drag13/CIDemo"><img src="https://codecov.io/gh/Drag13/CIDemo/branch/master/graph/badge.svg" alt="codecov"></a></p>
<h2>CI Deploy to Azure</h2>
<p>Here I will show how to setup deploymnt to Azure. But if you don't want to use Azure, Travis supports a lot of other deployment targets like Google and Amazon. <a href="https://docs.travis-ci.com/user/deployment/">Here</a> you can read more about deployment directly from Travis.</p>
<p>Default deployment to Azure is very simple. It is already tuned to work with .NET Core applications out of the box. So the only thing you need is to give Azure access to your repository and synchronize them. All other stuff will be done automatically.</p>
<p>Login to <a href="https://portal.azure.com">Azure</a> and create new site with this link
<a href="https://portal.azure.com/#create/Microsoft.WebSite">link</a>. Specify site name, subscription, and Operating System. Than select DeploymentOptions -&gt; Github -&gt; Project -&gt; Branch. After this, your remote repository will be synced with GitHub and a few minutes later - deployed.</p>
<h2>CI Deploy to Azure - Advanced</h2>
<p>But what if you need to do some advanced stuff like build UI, update web.config, or other something other? The cool thing that deployment process is fully configurable. All you need is to specify build script and describe steps you want to see.</p>
<p>Go back to the repository. Add two new files to the root of the project</p>
<ul>
<li><a href="https://github.com/Drag13/CIDemo/blob/master/.deployment">.deployment</a> // describes deployment steps</li>
<li><a href="https://github.com/Drag13/CIDemo/blob/master/deploy.cmd">build.cmd</a> // describe deployment process</li>
</ul>
<p>The build.cmd file may look a bit scary but in fact, it is very simple. Here what is going inside</p>
<ul>
<li>Setup paths</li>
<li>Install <a href="https://github.com/projectkudu/KuduSync">kudusync</a></li>
<li>Restore NuGet packages</li>
<li>Publish application</li>
<li>Copy publish result to the site folder</li>
</ul>
<p>The main idea is that this is only cmd script that allows you to do everything you need. You can use dotnet, NuGet, node, npm and other tools to customize your build process whatever you want. If you want to read more about deploymnt to Azure you can read this article - <a href="https://medium.com/@drag13dev/how-to-sync-your-github-repository-and-azure-40bdb564d788">How to build and deploy your front-end application from GitHub to Azure with Kudu</a></p>
<p>That is all! Hope this will help you to make your applications better. Have a nice day!</p>
<h2>Other CI tools</h2>
<p>Travis is not the only one can help you with free CI.
You also can check next projects:</p>
<ul>
<li><a href="https://codeship.com/pricing">codeship</a> (free for OpenSource)</li>
<li><a href="http://circleci.com/pricing/">circleci</a> (free 1,500 build minutes per month, special offers for OpenSource)</li>
<li><a href="https://buddy.works/pricing">buddy</a> free (120 executions/month)</li>
</ul>
<h2>Useful Links</h2>
<ul>
<li><a href="https://docs.travis-ci.com/">Travis documentation</a></li>
<li><a href="https://docs.codecov.io/docs">Codecov documentation</a></li>
<li><a href="https://github.com/tonerdo/coverlet/blob/master/README.md">Coverlet documentation</a></li>
<li><a href="https://github.com/projectkudu/KuduSync">Kudusync</a></li>
<li><a href="https://github.com/Drag13/FSharpWebAppWithCIDemo">DemoRepository</a></li>
<li><a href="https://medium.com/@drag13dev/how-to-sync-your-github-repository-and-azure-40bdb564d788">How to build and deploy your front-end application from GitHub to Azure with Kudu</a></li>
</ul>
</article></div></main><footer class="footer"><a href="https://github.com/Drag13/drag13.github.io/blob/development/LICENSE" target="_blank">2020 MIT by Drag13</a></footer></body></html>